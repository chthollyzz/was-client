<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>连接 WAS 服务器</title>
    <link rel="stylesheet" href="dist/semantic.min.css">
</head>

<body>
    <div class="ui container">
        <br>
        <h3>连接 WAS 服务器</h3>
        请确认您的信息：
        <div class="ui info message">
            <pre id="code"></pre>
        </div>
        <div class="ui error message" id="error">
            <b>错误：</b>您的 IP 位置 (<code id="realP"></code>) 与指定激活配置位置 (<code id="cfgP"></code>)
            不符，无法激活。请联系管理员获取新的配置代码，或在指定的激活地点激活配置（启用后可点击刷新按钮）。
        </div>
        <button class="ui green button" id="connect" disabled>连接</button>
        &nbsp;&nbsp;<button class="ui primary button" id="refresh">刷新位置</button>
    </div>
    <script src="dist/jquery-3.7.1.min.js"></script>
    <script src="dist/semantic.min.js"></script>
    <script>
        $("#error").hide();
        $("#refresh").hide();
        let country = {
            "AFG": "Afghanistan",
            "ALB": "Albania",
            "DZA": "Algeria",
            "ASM": "American Samoa",
            "AND": "Andorra",
            "AGO": "Angola",
            "AIA": "Anguilla",
            "ATA": "Antarctica",
            "ATG": "Antigua and Barbuda",
            "ARG": "Argentina",
            "ARM": "Armenia",
            "ABW": "Aruba",
            "AUS": "Australia",
            "AUT": "Austria",
            "AZE": "Azerbaijan",
            "BHS": "Bahamas",
            "BHR": "Bahrain",
            "BGD": "Bangladesh",
            "BRB": "Barbados",
            "BLR": "Belarus",
            "BEL": "Belgium",
            "BLZ": "Belize",
            "BEN": "Benin",
            "BMU": "Bermuda",
            "BTN": "Bhutan",
            "BOL": "Bolivia",
            "BES": "Bonaire, Sint Eustatius and Saba",
            "BIH": "Bosnia and Herzegovina",
            "BWA": "Botswana",
            "BVT": "Bouvet Island",
            "BRA": "Brazil",
            "IOT": "British Indian Ocean Territory",
            "BRN": "Brunei Darussalam",
            "BGR": "Bulgaria",
            "BFA": "Burkina Faso",
            "BDI": "Burundi",
            "CPV": "Cabo Verde",
            "KHM": "Cambodia",
            "CMR": "Cameroon",
            "CAN": "Canada",
            "CYM": "Cayman Islands",
            "CAF": "Central African Republic",
            "TCD": "Chad",
            "CHL": "Chile",
            "CHN": "China, People's Republic of",
            "CXR": "Christmas Island",
            "CCK": "Cocos (Keeling) Islands",
            "COL": "Colombia",
            "COM": "Comoros",
            "COD": "Congo, the Democratic Republic of",
            "COG": "Congo",
            "COK": "Cook Islands",
            "CRI": "Costa Rica",
            "HRV": "Croatia",
            "CUB": "Cuba",
            "CUW": "Curaçao",
            "CYP": "Cyprus",
            "CZE": "Czechia",
            "CIV": "Côte d'Ivoire",
            "DNK": "Denmark",
            "DJI": "Djibouti",
            "DMA": "Dominica",
            "DOM": "Dominican Republic",
            "ECU": "Ecuador",
            "EGY": "Egypt",
            "SLV": "El Salvador",
            "GNQ": "Equatorial Guinea",
            "ERI": "Eritrea",
            "EST": "Estonia",
            "SWZ": "Eswatini",
            "ETH": "Ethiopia",
            "FLK": "Falkland Islands",
            "FRO": "Faroe Islands",
            "FJI": "Fiji",
            "FIN": "Finland",
            "FRA": "France",
            "GUF": "French Guiana",
            "PYF": "French Polynesia",
            "ATF": "French Southern Territories",
            "GAB": "Gabon",
            "GMB": "Gambia",
            "GEO": "Georgia",
            "D<<": "Germany",
            "DEU": "Germany",
            "GHA": "Ghana",
            "GIB": "Gibraltar",
            "GRC": "Greece",
            "GRL": "Greenland",
            "GRD": "Grenada",
            "GLP": "Guadeloupe",
            "GUM": "Guam",
            "GTM": "Guatemala",
            "GGY": "Guernsey",
            "GIN": "Guinea",
            "GNB": "Guinea-Bissau",
            "GUY": "Guyana",
            "HTI": "Haiti",
            "HMD": "Heard Island and McDonald Islands",
            "VAT": "Holy See",
            "HND": "Honduras",
            "HKG": "Hong Kong",
            "HUN": "Hungary",
            "ISL": "Iceland",
            "IND": "India",
            "IDN": "Indonesia",
            "IRN": "Iran",
            "IRQ": "Iraq",
            "IRL": "Ireland",
            "IMN": "Isle of Man",
            "ISR": "Israel",
            "ITA": "Italy",
            "JAM": "Jamaica",
            "JPN": "Japan",
            "JEY": "Jersey",
            "JOR": "Jordan",
            "KAZ": "Kazakhstan",
            "KEN": "Kenya",
            "KIR": "Kiribati",
            "PRK": "Korea, the Democratic People's Republic of (North Korea)",
            "KOR": "Korea, the Republic of (South Korea)",
            "KWT": "Kuwait",
            "KGZ": "Kyrgyzstan",
            "LAO": "Lao People's Democratic Republic",
            "LVA": "Latvia",
            "LBN": "Lebanon",
            "LSO": "Lesotho",
            "LBR": "Liberia",
            "LBY": "Libya",
            "LIE": "Liechtenstein",
            "LTU": "Lithuania",
            "LUX": "Luxembourg",
            "MAC": "Macao",
            "MDG": "Madagascar",
            "MWI": "Malawi",
            "MYS": "Malaysia",
            "MDV": "Maldives",
            "MLI": "Mali",
            "MLT": "Malta",
            "MHL": "Marshall Islands",
            "MTQ": "Martinique",
            "MRT": "Mauritania",
            "MUS": "Mauritius",
            "MYT": "Mayotte",
            "MEX": "Mexico",
            "FSM": "Micronesia, Federated States of",
            "MDA": "Moldova",
            "MCO": "Monaco",
            "MNG": "Mongolia",
            "MNE": "Montenegro",
            "MSR": "Montserrat",
            "MAR": "Morocco",
            "MOZ": "Mozambique",
            "MMR": "Myanmar",
            "NAM": "Namibia",
            "NRU": "Nauru",
            "NPL": "Nepal",
            "NLD": "Netherlands",
            "NCL": "New Caledonia",
            "NZL": "New Zealand",
            "NIC": "Nicaragua",
            "NER": "Niger",
            "NGA": "Nigeria",
            "NIU": "Niue",
            "NFK": "Norfolk Island",
            "MNP": "Northern Mariana Islands",
            "NOR": "Norway",
            "OMN": "Oman",
            "PAK": "Pakistan",
            "PLW": "Palau",
            "PSE": "Palestine, State of",
            "PAN": "Panama",
            "PNG": "Papua New Guinea",
            "PRY": "Paraguay",
            "PER": "Peru",
            "PHL": "Philippines",
            "PCN": "Pitcairn",
            "POL": "Poland",
            "PRT": "Portugal",
            "PRI": "Puerto Rico",
            "QAT": "Qatar",
            "MKD": "Republic of North Macedonia",
            "ROU": "Romania",
            "RUS": "Russian Federation",
            "RWA": "Rwanda",
            "REU": "Réunion",
            "BLM": "Saint Barthélemy",
            "SHN": "Saint Helena, Ascension and Tristan da Cunha",
            "KNA": "Saint Kitts and Nevis",
            "LCA": "Saint Lucia",
            "MAF": "Saint Martin (French part)",
            "SPM": "Saint Pierre and Miquelon",
            "VCT": "Saint Vincent and the Grenadines",
            "WSM": "Samoa",
            "SMR": "San Marino",
            "STP": "Sao Tome and Principe",
            "SAU": "Saudi Arabia",
            "SEN": "Senegal",
            "SRB": "Serbia",
            "SYC": "Seychelles",
            "SLE": "Sierra Leone",
            "SGP": "Singapore",
            "SXM": "Sint Maarten (Dutch part)",
            "SVK": "Slovakia",
            "SVN": "Slovenia",
            "SLB": "Solomon Islands",
            "SOM": "Somalia",
            "ZAF": "South Africa",
            "SGS": "South Georgia and the South Sandwich Islands",
            "SSD": "South Sudan",
            "ESP": "Spain",
            "LKA": "Sri Lanka",
            "SDN": "Sudan",
            "SUR": "Suriname",
            "SJM": "Svalbard and Jan Mayen",
            "SWE": "Sweden",
            "CHE": "Switzerland",
            "SYR": "Syrian Arab Republic",
            "TWN": "Taiwan (Chinese Taipei)",
            "TJK": "Tajikistan",
            "TZA": "Tanzania, United Republic of",
            "THA": "Thailand",
            "TLS": "Timor-Leste",
            "TGO": "Togo",
            "TKL": "Tokelau",
            "TON": "Tonga",
            "TTO": "Trinidad and Tobago",
            "TUN": "Tunisia",
            "TUR": "Turkey",
            "TKM": "Turkmenistan",
            "TCA": "Turks and Caicos Islands",
            "TUV": "Tuvalu",
            "UGA": "Uganda",
            "UKR": "Ukraine",
            "ARE": "United Arab Emirates",
            "GBR": "United Kingdom of Great Britain and Northern Ireland",
            "UMI": "United States Minor Outlying Islands",
            "USA": "United States of America",
            "URY": "Uruguay",
            "UZB": "Uzbekistan",
            "VUT": "Vanuatu",
            "VEN": "Venezuela",
            "VNM": "Viet Nam",
            "VGB": "Virgin Islands (British)",
            "VIR": "Virgin Islands (U.S.)",
            "WLF": "Wallis and Futuna",
            "ESH": "Western Sahara",
            "YEM": "Yemen",
            "ZMB": "Zambia",
            "ZWE": "Zimbabwe",
            "ALA": "Åland Islands"
        };
        let cfg = localStorage.getItem('config');
        let countryCode = cfg.substring(2, 5);
        $("#code").text("Country Code: " + countryCode + " (" + country[countryCode] + ")\n");
        let pRequired = cfg.substring(5, 6) * 1;
        $("#code").append("Password Required: " + (pRequired ? 'Yes' : 'No') + "\n");
        let ipAddress = parseInt(cfg.substring(6, 8), 16) + '.' + parseInt(cfg.substring(8, 10), 16) + '.' + parseInt(cfg.substring(10, 12), 16) + '.' + parseInt(cfg.substring(12, 14), 16);
        $("#code").append("IP Address: " + ipAddress + "\n");
        let port = parseInt(cfg.substring(14, 18), 16);
        $("#code").append("Port: " + port + "\n");
        let expiryDate = parseInt(cfg.substring(18, 25), 16) + "";
        // yymmdddd
        expiryDate = expiryDate.substring(6, 8) + "/" + expiryDate.substring(4, 6) + "/" + expiryDate.substring(0, 4);
        $("#code").append("Expiry Date: " + expiryDate + "\n");
        const countryCodeMap = {
            "AF": "AFG",
            "AL": "ALB",
            "DZ": "DZA",
            "AS": "ASM",
            "AD": "AND",
            "AO": "AGO",
            "AI": "AIA",
            "AQ": "ATA",
            "AG": "ATG",
            "AR": "ARG",
            "AM": "ARM",
            "AW": "ABW",
            "AU": "AUS",
            "AT": "AUT",
            "AZ": "AZE",
            "BS": "BHS",
            "BH": "BHR",
            "BD": "BGD",
            "BB": "BRB",
            "BY": "BLR",
            "BE": "BEL",
            "BZ": "BLZ",
            "BJ": "BEN",
            "BM": "BMU",
            "BT": "BTN",
            "BO": "BOL",
            "BQ": "BES",
            "BA": "BIH",
            "BW": "BWA",
            "BV": "BVT",
            "BR": "BRA",
            "IO": "IOT",
            "BN": "BRN",
            "BG": "BGR",
            "BF": "BFA",
            "BI": "BDI",
            "CV": "CPV",
            "KH": "KHM",
            "CM": "CMR",
            "CA": "CAN",
            "KY": "CYM",
            "CF": "CAF",
            "TD": "TCD",
            "CL": "CHL",
            "CN": "CHN",
            "CX": "CXR",
            "CC": "CCK",
            "CO": "COL",
            "KM": "COM",
            "CD": "COD",
            "CG": "COG",
            "CK": "COK",
            "CR": "CRI",
            "HR": "HRV",
            "CU": "CUB",
            "CW": "CUW",
            "CY": "CYP",
            "CZ": "CZE",
            "CI": "CIV",
            "DK": "DNK",
            "DJ": "DJI",
            "DM": "DMA",
            "DO": "DOM",
            "EC": "ECU",
            "EG": "EGY",
            "SV": "SLV",
            "GQ": "GNQ",
            "ER": "ERI",
            "EE": "EST",
            "SZ": "SWZ",
            "ET": "ETH",
            "FK": "FLK",
            "FO": "FRO",
            "FJ": "FJI",
            "FI": "FIN",
            "FR": "FRA",
            "GF": "GUF",
            "PF": "PYF",
            "TF": "ATF",
            "GA": "GAB",
            "GM": "GMB",
            "GE": "GEO",
            "DE": "D<<",
            "GH": "GHA",
            "GI": "GIB",
            "GR": "GRC",
            "GL": "GRL",
            "GD": "GRD",
            "GP": "GLP",
            "GU": "GUM",
            "GT": "GTM",
            "GG": "GGY",
            "GN": "GIN",
            "GW": "GNB",
            "GY": "GUY",
            "HT": "HTI",
            "HM": "HMD",
            "VA": "VAT",
            "HN": "HND",
            "HK": "HKG",
            "HU": "HUN",
            "IS": "ISL",
            "IN": "IND",
            "ID": "IDN",
            "IR": "IRN",
            "IQ": "IRQ",
            "IE": "IRL",
            "IM": "IMN",
            "IL": "ISR",
            "IT": "ITA",
            "JM": "JAM",
            "JP": "JPN",
            "JE": "JEY",
            "JO": "JOR",
            "KZ": "KAZ",
            "KE": "KEN",
            "KI": "KIR",
            "KP": "PRK",
            "KR": "KOR",
            "KW": "KWT",
            "KG": "KGZ",
            "LA": "LAO",
            "LV": "LVA",
            "LB": "LBN",
            "LS": "LSO",
            "LR": "LBR",
            "LY": "LBY",
            "LI": "LIE",
            "LT": "LTU",
            "LU": "LUX",
            "MO": "MAC",
            "MG": "MDG",
            "MW": "MWI",
            "MY": "MYS",
            "MV": "MDV",
            "ML": "MLI",
            "MT": "MLT",
            "MH": "MHL",
            "MQ": "MTQ",
            "MR": "MRT",
            "MU": "MUS",
            "YT": "MYT",
            "MX": "MEX",
            "FM": "FSM",
            "MD": "MDA",
            "MC": "MCO",
            "MN": "MNG",
            "ME": "MNE",
            "MS": "MSR",
            "MA": "MAR",
            "MZ": "MOZ",
            "MM": "MMR",
            "NA": "NAM",
            "NR": "NRU",
            "NP": "NPL",
            "NL": "NLD",
            "NC": "NCL",
            "NZ": "NZL",
            "NI": "NIC",
            "NE": "NER",
            "NG": "NGA",
            "NU": "NIU",
            "NF": "NFK",
            "MP": "MNP",
            "NO": "NOR",
            "OM": "OMN",
            "PK": "PAK",
            "PW": "PLW",
            "PS": "PSE",
            "PA": "PAN",
            "PG": "PNG",
            "PY": "PRY",
            "PE": "PER",
            "PH": "PHL",
            "PN": "PCN",
            "PL": "POL",
            "PT": "PRT",
            "PR": "PRI",
            "QA": "QAT",
            "MK": "MKD",
            "RO": "ROU",
            "RU": "RUS",
            "RW": "RWA",
            "RE": "REU",
            "BL": "BLM",
            "SH": "SHN",
            "KN": "KNA",
            "LC": "LCA",
            "MF": "MAF",
            "PM": "SPM",
            "VC": "VCT",
            "WS": "WSM",
            "SM": "SMR",
            "ST": "STP",
            "SA": "SAU",
            "SN": "SEN",
            "RS": "SRB",
            "SC": "SYC",
            "SL": "SLE",
            "SG": "SGP",
            "SX": "SXM",
            "SK": "SVK",
            "SI": "SVN",
            "SB": "SLB",
            "SO": "SOM",
            "ZA": "ZAF",
            "GS": "SGS",
            "SS": "SSD",
            "ES": "ESP",
            "LK": "LKA",
            "SD": "SDN",
            "SR": "SUR",
            "SJ": "SJM",
            "SE": "SWE",
            "CH": "CHE",
            "SY": "SYR",
            "TW": "TWN",
            "TJ": "TJK",
            "TZ": "TZA",
            "TH": "THA",
            "TL": "TLS",
            "TG": "TGO",
            "TK": "TKL",
            "TO": "TON",
            "TT": "TTO",
            "TN": "TUN",
            "TR": "TUR",
            "TM": "TKM",
            "TC": "TCA",
            "TV": "TUV",
            "UG": "UGA",
            "UA": "UKR",
            "AE": "ARE",
            "GB": "GBR",
            "UM": "UMI",
            "US": "USA",
            "UY": "URY",
            "UZ": "UZB",
            "VU": "VUT",
            "VE": "VEN",
            "VN": "VNM",
            "VG": "VGB",
            "VI": "VIR",
            "WF": "WLF",
            "EH": "ESH",
            "YE": "YEM",
            "ZM": "ZMB",
            "ZW": "ZWE",
            "AX": "ALA"
        };
        // get ip country
        $.ajax({
            type: "GET",
            url: "https://ipinfo.io/json",
            success: function (data) {
                // turn data.country into 3-digit country code
                // SG -> SGP
                let country = data.country;
                if (countryCodeMap[country] == countryCode) {
                    document.getElementById("connect").disabled = false;
                    $("#error").hide();
                    $("#refresh").hide();
                } else {
                    document.getElementById("realP").innerText = countryCodeMap[country];
                    document.getElementById("cfgP").innerText = countryCode;
                    $("#error").show();
                    $("#refresh").show();
                    document.getElementById("connect").disabled = true;
                }
            }
        });
        $("#refresh").click(function () {
            $.ajax({
                type: "GET",
                url: "https://ipinfo.io/json",
                success: function (data) {
                    // turn data.country into 3-digit country code
                    // SG -> SGP
                    let country = data.country;
                    if (countryCodeMap[country] == countryCode) {
                        document.getElementById("connect").disabled = false;
                        $("#error").hide();
                        $("#refresh").hide();
                    } else {
                        document.getElementById("realP").innerText = countryCodeMap[country];
                        document.getElementById("cfgP").innerText = countryCode;
                        $("#error").show();
                        $("#refresh").show();
                        document.getElementById("connect").disabled = true;
                    }
                }
            });
        });
    </script>
</body>

</html>